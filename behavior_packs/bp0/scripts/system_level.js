import{system,world,EntityEquippableComponent,EquipmentSlot}from"@minecraft/server";import{addScore,addEffect,removeEffect,setScore,getScore,addDamage,takeOneItem}from"./functions.js";import{BreakBlock,setToMaxDurability}from"./itemsDamage.js";import{reactive_temp}from"./temp_sphere.js";import{reactive_thirst}from"./thirts.js";import{calculateTotalValue}from"./classifications.js";export function systemLevel_events(e,t){switch(t){case"hfrlc:movementDetect":e.hasTag("used")&&MovementDetect(e);break;case"hfrlc:level_speed10":handleSpeedLevelEvent(e);break;case"hfrlc:healCrystalUse":healCrystalUse(e);break;case"hfrlc:desactive_systemLevel":e.hasTag("used")&&desactive_systemLevel(e);break;case"hfrlc:saving_grace_loop":e.hasTag("saving_grace")&&(addScore(e,"saving_grace",2),getScore(e,"saving_grace")>=300&&(e.removeTag("saving_grace"),e.sendMessage({translate:"active.saving_grace"}),e.playSound("random.levelup"),setScore(e,"saving_grace",0)));break;case"hfrlc:saving_grace":triggerSavingGrace(e);break;case"hfrlc:mining_skills":updateMiningSkills(e)}}function handleSpeedLevelEvent(e){const t=e.getTags(),a=e.hasTag("pirate_armor_set");for(const l of t){if(!l.startsWith('{"trinkets":{"id":"hfrlc:mining_amulet",')&&e.hasTag("level_mining10")){const t=e.hasTag("obsidian")?3:1;addEffect(e,"haste",20,t,!1)}l.includes('{"trinkets":{"id":"hfrlc:ring_speed",')||l.includes('{"trinkets":{"id":"hfrlc:feather_swiftness",')||!e.hasTag("level_speed10")||addEffect(e,"speed",40,a?2:0,!1)}}function triggerSavingGrace(e){e.triggerEvent("hfrlc:saving_grace_time"),e.addTag("saving_grace"),addEffect(e,"regeneration",400,1,!0),addEffect(e,"absorption",25,1,!0),addEffect(e,"fire_resistance",400,1,!0),e.playSound("random.totem"),e.spawnParticle("minecraft:totem_particle",e.location),removeEffect(e,"weakness"),removeEffect(e,"mining_fatigue"),removeEffect(e,"slowness")}function updateMiningSkills(e){const t=e.getBlockFromViewDirection({includeLiquidBlocks:!0,maxDistance:6}),a=e.getComponent(EntityEquippableComponent.componentId),l=a?.getEquipment(EquipmentSlot.Mainhand),o="minecraft:diamond_pickaxe"===l?.typeId||"minecraft:netherite_pickaxe"===l?.typeId,n=t?.block.typeId.includes("obsidian");t&&l&&o&&n?e.addTag("obsidian"):e.removeTag("obsidian")}function desactive_systemLevel(e){e.getTags().forEach(t=>{t.startsWith("sl:")&&(e.triggerEvent("hfrlc:system_level0"),e.removeTag("used"),e.getTags().forEach(t=>{if(t.startsWith("sl_barrier:")){const a=t.replace("sl_barrier:","").split(" "),l=a[0],o=a[1],n=a[2],r=a[3],s=a[4],i=a[5];e.runCommandAsync(`fill ${l} ${o} ${n} ${r} ${s} ${i} air [] replace barrier`),e.removeTag(t)}}),system.runTimeout(()=>{const a=e.dimension.getEntities({type:"hfrlc:system_level",tags:[`${e.name}`]});for(const e of a)e.remove();e.runCommandAsync(`tp @s ${t.replace("sl:","")}`),e.camera.clear(),e.inputPermissions.cameraEnabled=!0,e.removeTag(t)},2),system.runTimeout(()=>{e.hasTag("active_bodypart")&&e.triggerEvent("hfrlc:bodyparts_active"),e.hasTag("used")||reactive_thirst(e)},5),system.runTimeout(()=>{e.hasTag("used")||reactive_temp(e)},10))})}export function systemLevelSpawn(e){(e.hasTag("used")||0==!e.getProperty("hfrlc:system_level"))&&(desactive_systemLevel(e),e.triggerEvent("hfrlc:system_level0"),e.removeTag("used"))}function skillsDamage(e,t,a,l,o,n){if("minecraft:player"==e.typeId){if("projectile"==l&&(e.hasTag("level_speed20")&&!t.getComponent("minecraft:type_family")?.hasTypeFamily("boss")&&Math.floor(100*Math.random())+1<21&&addEffect(t,"levitation",30,3,!0),e.hasTag("level_speed30")&&Math.floor(100*Math.random())+1>50&&(addDamage(t,Math.round(o),e),t))){const e=t.getComponent("health").currentValue;system.runTimeout(()=>{t&&e>0&&t.dimension.spawnParticle("minecraft:critical_hit_emitter",{x:t.location.x,y:t.location.y+1.5,z:t.location.z})},10)}if("entityAttack"==l&&e.hasTag("level_melee30")&&Math.floor(100*Math.random())+1<16){e.dimension.getEntities({excludeTypes:["minecraft:player"]}).forEach(t=>{const a=e.location,l=t.location,n=Math.sqrt(Math.pow(l.x-a.x,2)+Math.pow(l.y-a.y,2)+Math.pow(l.z-a.z,2)),r=t.hasComponent("minecraft:is_tamed");n<=10&&(r||(t.applyDamage(Math.floor(o)+1),t.addTag("damage_indicator_m"),e.addTag("active_sound")))}),e.hasTag("active_sound")&&(e.playSound("random.explode"),e.removeTag("active_sound"))}if("entityAttack"==l&&e.hasTag("level_melee50")&&addDamage(t,Math.round(o/2),e),"entityAttack"==l&&e.hasTag("level_melee20")&&!t.getComponent("minecraft:type_family")?.hasTypeFamily("boss")&&Math.floor(100*Math.random())+1<11&&(addEffect(t,"slowness",100,20,!0),addEffect(t,"weakness",100,20,!0),t.addTag("damage_indicator_s")),e.hasTag("level_melee40")){const t=e.getComponent("health"),a=t.currentValue;if("entityAttack"==l&&Math.floor(o)<=9&&Math.floor(o)>=5&&t.setCurrentValue(a+1),"entityAttack"==l&&Math.floor(o)>=10){const l=Math.floor(o/5);if(t.setCurrentValue(a+l),l<5){const t=["rleg_heal","lleg_heal","larm_heal","rarm_heal"],a=["larm_heal","rarm_heal","rleg_heal","lleg_heal"],l=Math.floor(4*Math.random()),o=Math.floor(4*Math.random());e.triggerEvent(`hfrlc:${t[l]}`),e.triggerEvent(`hfrlc:${a[o]}`)}if(l>=5&&l<9){const t=["rleg_heal","lleg_heal","larm_heal","rarm_heal"],a=["larm_heal","rarm_heal","rleg_heal","lleg_heal"],l=Math.floor(4*Math.random()),o=Math.floor(4*Math.random());e.triggerEvent(`hfrlc:${t[l]}`),e.triggerEvent(`hfrlc:${a[o]}`);const n=Math.floor(4*Math.random()),r=Math.floor(4*Math.random());e.triggerEvent(`hfrlc:${t[n]}`),e.triggerEvent(`hfrlc:${a[r]}`)}l>=9&&e.triggerEvent("hfrlc:bodyparts_reset")}}if("entityAttack"==l&&e.hasTag("level_melee10")&&Math.floor(100*Math.random())+1<21&&t){const a=t.getComponent("health").currentValue;addDamage(t,Math.round(o),e),system.runTimeout(()=>{t&&a>0&&t.dimension.spawnParticle("minecraft:critical_hit_emitter",{x:t.location.x,y:t.location.y+1.5,z:t.location.z})},10)}}}function levelDetect(e){const t={melee:getScore(e,"melee"),mining:getScore(e,"mining"),agility:getScore(e,"agility"),armor:getScore(e,"armor")},a={agility:[{level:6,tag:"speed6"},{level:10,tag:"level_speed10",message:"action.speed_skill"},{level:15,tag:"speed15"},{level:20,tag:"level_speed20",message:"action.arrow_skill"},{level:30,tag:"level_speed30",message:"action.critical_skill"},{level:40,tag:"level_speed40",message:"action.dodge_skill"},{level:50,tag:"level_speed50",message:"action.mastery_skill"}],mining:[{level:10,tag:"level_mining10",message:"action.haste_skill"},{level:20,tag:"level_mining20",message:"action.obsidian_skill"},{level:30,tag:"level_mining30",message:"action.sustaining_skill"},{level:40,tag:"level_mining40",message:"action.material_skill"},{level:50,tag:"level_mining50",message:"action.luck_skill"}],melee:[{level:10,tag:"level_melee10",message:"action.chance_skill"},{level:20,tag:"level_melee20",message:"action.stun_skill"},{level:30,tag:"level_melee30",message:"action.area_skill"},{level:40,tag:"level_melee40",message:"action.vampirism_skill"},{level:50,tag:"level_melee50",message:"action.melee_skill"}],armor:[{level:10,tag:"level_armor10",message:"action.thorns_skill"},{level:20,tag:"level_armor20",message:"action.boost_skill"},{level:30,tag:"level_armor30",message:"action.bodyparts_skill"},{level:40,tag:"level_armor40",message:"action.heal_skill"},{level:50,tag:"level_armor50",message:"action.saving_skill"}]};for(const[l,o]of Object.entries(a)){const a=t[l];for(const{level:t,tag:l,message:n}of o)a>=t&&!e.hasTag(l)&&(n&&e.sendMessage({translate:n}),e.addTag(l))}}function MovementDetect(e){function t(t,a,l=null){t&&!e.hasTag(a)?(l&&e.triggerEvent(l),e.addTag(a)):!t&&e.hasTag(a)&&e.removeTag(a)}t(e.isSneaking,"down","hfrlc:sl_down"),t(e.isJumping,"up","hfrlc:sl_up"),e.hasTag("up")&&e.runCommandAsync(`execute as @e[type=hfrlc:system_level,tag="${e.name}"] at @s run tp "${e.name}" ~~~`);const a=e.getVelocity();if(Math.abs(a.x)+Math.abs(a.z)>0){[{offset:"^-1^^",event:"hfrlc:sl_der"},{offset:"^1^^",event:"hfrlc:sl_izq"},{offset:"^^^1",event:null},{offset:"^^^-1",event:null}].forEach(({offset:t,event:a})=>{let l=`execute as @e[type=hfrlc:system_level,tag="${e.name}"] at @s positioned ${t} as @p[name="${e.name}",r=0.99]`;a&&e.runCommandAsync(`${l} run event entity @s ${a}`),e.runCommandAsync(`${l} at @e[type=hfrlc:system_level,tag="${e.name}"] run tp "${e.name}" ~~~`)})}}function SystemLevel(e){e.hasTag("active_tuto20")&&!e.hasTag("tuto_openSystemLevel")&&(e.sendMessage({translate:"tutorial.dialogue.subtitles14"}),e.runCommandAsync("stopsound @s tutorial.dialogue.13"),e.playSound("tutorial.dialogue.14",{volume:9}),e.addTag("tuto_openSystemLevel")),e.runCommandAsync("title @s subtitle hide;"),e.triggerEvent("hfrlc:bodyparts_desactive");const t="minecraft:nether"==e.dimension.id?128:250,a=32*Math.random(),l=32*Math.random();e.camera.setCamera("minecraft:first_person");const o=e.getRotation();e.addTag(`sl:${e.location.x.toFixed(2)} ${e.location.y.toFixed(2)} ${e.location.z.toFixed(2)} ${o.y.toFixed(2)} ${o.x.toFixed(2)}`),e.teleport({x:Math.floor(e.location.x+a)+1,y:t,z:Math.floor(e.location.z+l)+1}),e.triggerEvent("remove_cold_shaking");const n=Math.floor(e.location.x)+2,r=Math.floor(e.location.y)+3,s=Math.floor(e.location.z)+2,i=Math.floor(e.location.x)-2,c=Math.floor(e.location.y)-1,d=Math.floor(e.location.z)-2;e.addTag(`sl_barrier:${n} ${r} ${s} ${i} ${c} ${d}`),e.runCommandAsync(`fill ${n} ${r} ${s} ${i} ${c} ${d} barrier [] hollow`),e.inputPermissions.cameraEnabled=!1,e.addTag("used"),e.triggerEvent("hfrlc:active_systemLevel");const m=calculateTotalValue(e);e.setProperty("hfrlc:power_level",m),system.runTimeout(()=>{const t=e.dimension.spawnEntity("hfrlc:system_level",{x:Math.floor(e.location.x),y:Math.floor(e.location.y),z:Math.floor(e.location.z)});t.addTag(`${e.name}`),t.runCommandAsync(`tp "${e.name}" ~~~ 0 0`)},2),system.runTimeout(()=>{e.triggerEvent("hfrlc:system_level_start")},5)}let arrowSave,arrowSlot;export function systemLevel_itemRelease(e,t){const a=e.getComponent("inventory").container,l=e.getComponent(EntityEquippableComponent.componentId);if(t.typeId.includes("trident")&&!e.hasTag("speed6")&&(l.setEquipment(EquipmentSlot.Mainhand,t),e.onScreenDisplay.setActionBar({translate:"blocked.agility"})),!e.hasTag("speed6")&&t.typeId.includes("bow")&&"minecraft:crossbow"!=t.typeId){e.onScreenDisplay.setActionBar({translate:"blocked.agility"});for(let l=0;l<a.size;l++){const o=a.getItem(l);o&&"minecraft:arrow"==o.typeId&&(a.setItem(l,arrowSave),setToMaxDurability(e,t))}}e.hasTag("level_speed50")&&"minecraft:bow"==t.typeId&&e.runCommandAsync("give @s arrow 1")}export function systemLevelItemCompleteUse(e,t){e.getComponent("inventory").container;"minecraft:crossbow"==t.typeId&&e.hasTag("level_speed50")&&e.runCommandAsync("give @s arrow 1")}export function systemLevel_projectileHit(e,t){e&&"minecraft:player"==e.typeId&&e.hasTag("dodge")&&system.runTimeout(()=>{e.removeTag("dodge"),e.hasTag("dodge_active")||(e.addTag("dodge_active"),e.onScreenDisplay.setActionBar({translate:"action.dodge"}),e.playSound("random.dodge"))},5)}const arrows=["hfrlc:fire_arrow","hfrlc:ice_arrow","hfrlc:player_bow","minecraft:arrow"];export function systemLevel_projectileHitBlock(e,t,a){t&&("minecraft:player"==t.typeId&&t.hasTag("level_speed50")&&arrows.forEach(t=>{e&&e.typeId==t&&e.remove()}),"minecraft:player"==t.typeId&&e&&"hfrlc:ender_tp_dummy"==e.typeId&&(t.teleport(a),system.runTimeout(()=>{t.playSound("mob.shulker.teleport")},2)))}const other_allows=["deepslate","basalt","end_stone","netherrack","blackstone","tuff","end_bricks","nether_bricks","dripstone","cobbled_deepslate","red_nether_bricks","calcite"],allowsBlocks=["deepslate","tuff","dripstone","cobbled_deepslate","calcite"];export function systemLevelBreakBlock(e,t,a,l,o){o&&e.hasTag("level_mining40")&&t&&t.typeId.includes("_pickaxe")&&(o.hasTag("stone")&&(o.typeId.includes(no_allowBlocks)||mininglvl40(e,a)),allowsBlocks.forEach(t=>{o.typeId==`minecraft:${t}`&&mininglvl40(e,a)})),o&&e.hasTag("level_mining30")&&t&&t.typeId.includes("_pickaxe")&&(o.hasTag("stone")&&(o.typeId.includes(no_allowBlocks)||mininglvl30(e)),other_allows.forEach(t=>{o.typeId==`minecraft:${t}`&&mininglvl30(e)})),system.run(()=>{if(e.hasTag("level_mining20")&&e.hasTag("obsidian")&&e.removeTag("obsidian"),e.hasTag("level_mining50")&&t){if("minecraft:diamond_pickaxe"==t.typeId||"minecraft:netherite_pickaxe"==t.typeId||"minecraft:iron_pickaxe"==t.typeId){l=["diamond","gold","iron","copper","coal","emerald","redstone","lapis","deepslate_diamond","deepslate_gold","deepslate_iron","deepslate_copper","deepslate_coal","deepslate_emerald","deepslate_redstone","deepslate_lapis"];for(const t of l)e.hasTag(t)&&(e.runCommandAsync(`loot spawn ${a[0]} ${a[1]} ${a[2]} loot "luck/${t}"`),e.removeTag(t))}if("minecraft:stone_pickaxe"==t.typeId){l=["iron","copper","coal","lapis","deepslate_iron","deepslate_copper","deepslate_coal","deepslate_lapis"];for(const t of l)e.hasTag(t)&&(e.runCommandAsync(`loot spawn ${a[0]} ${a[1]} ${a[2]} loot "luck/${t}"`),e.removeTag(t))}if("minecraft:wooden_pickaxe"==t.typeId||"minecraft:golden_pickaxe"==t.typeId){l=["coal","copper","deepslate_coal","deepslate_copper"];for(const t of l)e.hasTag(t)&&(e.runCommandAsync(`loot spawn ${a[0]} ${a[1]} ${a[2]} loot "luck/${t}"`),e.removeTag(t))}}})}function mininglvl40(e,t){Math.floor(100*Math.random())+1<3&&e.runCommandAsync(`loot spawn ${t[0]} ${t[1]} ${t[2]} loot "diamond"`)}function mininglvl30(e){system.runTimeout(()=>{const t=getScore(e,"bedrock");addScore(e,"bedrock",1),t>=9&&(addScore(e,"thirst",4700),addEffect(e,"saturation",1,0,!1),setScore(e,"bedrock",0))},1)}export function systemLevelItemUseOn(e,t,a,l){const o=t.getLore(),n=a.typeId,r={_axe:()=>n.includes("log")&&!n.includes("stripped"),_hoe:()=>n.includes("grass")||n.includes("dirt"),_shovel:()=>(n.includes("grass")||n.includes("dirt"))&&!n.includes("path")},s={_axe:()=>n.replace("stripped_",""),_hoe:()=>n,_shovel:()=>n},i=e=>e?.includes("Mining")&&e.includes("§c");for(const a in r)if(t.typeId.includes(a))for(const t of o)if(i(t)&&r[a]()){const t=s[a](),[o,n,r]=l;return void e.runCommandAsync(`fill ${o} ${n} ${r} ${o} ${n} ${r} ${t}`)}}export function systemLevelHitBlock(e,t){t.location.x,t.location.y,t.location.z;const a=e.getComponent(EntityEquippableComponent.componentId).getEquipment(EquipmentSlot.Mainhand);let l;if(a&&e.hasTag("level_mining50")){if("minecraft:diamond_pickaxe"==a.typeId||"minecraft:netherite_pickaxe"==a.typeId||"minecraft:iron_pickaxe"==a.typeId){l=["diamond","gold","iron","copper","coal","emerald","redstone","lapis","deepslate_diamond","deepslate_gold","deepslate_iron","deepslate_copper","deepslate_coal","deepslate_emerald","deepslate_redstone","deepslate_lapis"];for(const a of l)t.type.id==`minecraft:${a}_ore`&&e.addTag(a),t.type.id!=`minecraft:${a}_ore`&&e.removeTag(a)}if("minecraft:stone_pickaxe"==a.typeId){l=["iron","copper","coal","lapis","deepslate_iron","deepslate_copper","deepslate_coal","deepslate_lapis"];for(const a of l)t.type.id==`minecraft:${a}_ore`&&e.addTag(a),t.type.id!=`minecraft:${a}_ore`&&e.removeTag(a)}if("minecraft:wooden_pickaxe"==a.typeId||"minecraft:golden_pickaxe"==a.typeId){l=["copper","coal","deepslate_coal","deepslate_lapis"];for(const a of l)t.type.id==`minecraft:${a}_ore`&&e.addTag(a),t.type.id!=`minecraft:${a}_ore`&&e.removeTag(a)}}}const no_allowBlocks=["_wall","_slab","_stairs","_button","polished_","smooth_"];function healCrystal(e){const t=getScore(e,"armor"),a=e.getComponent("health").defaultValue;t>=20&&!e.hasTag("health1")&&(e.triggerEvent(`crystal_health${a+4}`),e.addTag("health1")),t>=30&&!e.hasTag("health2")&&(e.triggerEvent(`crystal_health${a+4}`),e.addTag("health2")),t>=40&&!e.hasTag("health3")&&(e.triggerEvent(`crystal_health${a+4}`),e.addTag("health3")),t>=45&&!e.hasTag("health4")&&(e.triggerEvent(`crystal_health${a+4}`),e.addTag("health4")),t>=50&&!e.hasTag("health5")&&(e.triggerEvent(`crystal_health${a+4}`),e.addTag("health5"))}function healCrystalUse(e){const t=e.getComponent("health").defaultValue,a=getScore(e,"health");a<10&&(addScore(e,"health",1),e.triggerEvent(`crystal_health${t+2}`),addEffect(e,"regeneration",20,3,!1),takeOneItem(e),e.playSound("random.levelup"),healCrystal(e)),a>=10&&(e.sendMessage({translate:"action.max_hearts"}),e.playSound("random.no_options"))}export function resetHealCrystalUse(e){const t=e.getComponent("health").defaultValue,a=getScore(e,"health");e.triggerEvent("crystal_health"+(t-2*a)),setScore(e,"health",0)}export function systemLevelItemUse(e,t){e.getComponent(EntityEquippableComponent.componentId);const a=t.getLore()[1],l=t.getLore()[2],o=e.getComponent("inventory").container;if(t.typeId.includes("bow")&&!e.hasTag("speed6"))for(let r=0;r<o.size;r++){const s=o.getItem(r);s&&"minecraft:arrow"==s.typeId&&(e.onScreenDisplay.setActionBar({translate:"blocked.agility"}),arrowSave=s,"minecraft:crossbow"==t.typeId&&setToMaxDurability(e,t))}if("minecraft:bow"!=t.typeId&&"minecraft:trident"!=t.typeId&&"minecraft:crossbow"!=t.typeId&&(a&&a.includes("Agility")&&a.includes("§c")&&e.onScreenDisplay.setActionBar({translate:"blocked.agility"}),l&&l.includes("Agility")&&l.includes("§c")&&e.onScreenDisplay.setActionBar({translate:"blocked.agility"})),"hfrlc:system_level"===t.typeId&&e.getProperty("hfrlc:system_level")>0){const i=getScore(e,"melee"),c=getScore(e,"mining"),d=getScore(e,"agility"),m=getScore(e,"armor"),g=1*i+1,p=1*c+1,_=1*d+1,h=1*m+1;(2==e.getProperty("hfrlc:system_level")&&i>=50||3==e.getProperty("hfrlc:system_level")&&m>=50||4==e.getProperty("hfrlc:system_level")&&d>=50||5==e.getProperty("hfrlc:system_level")&&c>=50)&&(e.sendMessage({translate:"action.limit_level"}),e.playSound("random.no_options")),2==e.getProperty("hfrlc:system_level")&&(e.hasTag("start_game")||(e.sendMessage({translate:"action.system_level.only_mining"}),e.playSound("random.no_options")),e.level>=g&&i<50&&e.hasTag("start_game")&&(e.runCommandAsync(`xp -${g}l`),setScore(e,"melee",i+1),e.setProperty("hfrlc:melee_unlock",i+1),e.sendMessage({rawtext:[{translate:"action.reach_level"},{text:` ${i+1}/50`},{translate:"action.in_melee"}]}),e.playSound("random.levelup")),e.level<g&&i<50&&e.hasTag("start_game")&&(e.sendMessage({rawtext:[{translate:"action.you_need"},{text:`${g}`},{translate:"action.need_xp"}]}),e.playSound("random.no_options"))),3==e.getProperty("hfrlc:system_level")&&(e.hasTag("start_game")||(e.sendMessage({translate:"action.system_level.only_mining"}),e.playSound("random.no_options")),e.level>=h&&m<50&&e.hasTag("start_game")&&(e.runCommandAsync(`xp -${h}l`),e.sendMessage({rawtext:[{translate:"action.reach_level"},{text:` ${m+1}/50`},{translate:"action.in_armor"}]}),setScore(e,"armor",m+1),e.setProperty("hfrlc:armor_unlock",m+1),e.playSound("random.levelup")),e.level<h&&m<50&&e.hasTag("start_game")&&(e.sendMessage({rawtext:[{translate:"action.you_need"},{text:`${h}`},{translate:"action.need_xp"}]}),e.playSound("random.no_options"))),4==e.getProperty("hfrlc:system_level")&&(e.hasTag("start_game")||(e.sendMessage({translate:"action.system_level.only_mining"}),e.playSound("random.no_options")),e.level>=_&&d<50&&e.hasTag("start_game")&&(e.runCommandAsync(`xp -${_}l`),e.sendMessage({rawtext:[{translate:"action.reach_level"},{text:` ${d+1}/50`},{translate:"action.in_agility"}]}),setScore(e,"agility",d+1),e.setProperty("hfrlc:agility_unlock",d+1),e.playSound("random.levelup")),e.level<_&&d<50&&e.hasTag("start_game")&&(e.sendMessage({rawtext:[{translate:"action.you_need"},{text:`${_}`},{translate:"action.need_xp"}]}),e.playSound("random.no_options"))),5==e.getProperty("hfrlc:system_level")&&(!e.hasTag("start_game")&&e.hasTag("only_level_mining")&&(e.sendMessage({translate:"action.system_level.only_use"}),e.playSound("random.no_options")),e.level>=p&&c<50&&(!e.hasTag("only_level_mining")||e.hasTag("start_game"))&&(e.runCommandAsync(`xp -${p}l`),e.sendMessage({rawtext:[{translate:"action.reach_level"},{text:` ${c+1}/50`},{translate:"action.in_mining"}]}),setScore(e,"mining",c+1),e.setProperty("hfrlc:mining_unlock",c+1),e.playSound("random.levelup"),!e.hasTag("start_game")&&c>=2&&e.addTag("only_level_mining")),e.level<p&&c<50&&e.hasTag("start_game")&&(e.sendMessage({rawtext:[{translate:"action.you_need"},{text:`${p}`},{translate:"action.need_xp"}]}),e.playSound("random.no_options"))),levelDetect(e),healCrystal(e)}if("hfrlc:system_level"===t.typeId&&!e.hasTag("used")&&0==e.getProperty("hfrlc:system_level")){function n(){const t=e.getVelocity();0!==Math.hypot(t.x,t.y,t.z)?e.sendMessage({translate:"action.stop_move"}):(e.onScreenDisplay.setTitle("no_ui;"),SystemLevel(e))}e.hasTag("do_tuto0")?e.hasTag("active_tuto20")||e.hasTag("active_tuto21")?n():(e.sendMessage({translate:"action.item_block"}),e.dimension.playSound("note.banjo",e.location,{pitch:.5})):n()}if("hfrlc:xp"===t.typeId&&(takeOneItem(e),e.runCommandAsync("xp 15l"),e.playSound("random.levelup")),t.typeId.includes("_token")){const y=getScore(e,"melee"),f=getScore(e,"mining"),v=getScore(e,"agility"),u=getScore(e,"armor");"hfrlc:melee_token"===t.typeId&&y<50&&(takeOneItem(e),e.sendMessage({rawtext:[{translate:"action.reach_level"},{text:` ${y+1}/50`},{translate:"action.in_melee"}]}),setScore(e,"melee",y+1),e.setProperty("hfrlc:melee_unlock",y+1),e.playSound("random.levelup")),("hfrlc:melee_token"===t.typeId&&y>=50||"hfrlc:armor_token"===t.typeId&&u>=50||"hfrlc:agility_token"===t.typeId&&v>=50||"hfrlc:mining_token"===t.typeId&&f>=50)&&(e.sendMessage({translate:"action.limit_level"}),e.playSound("random.no_options")),"hfrlc:armor_token"===t.typeId&&u<50&&(takeOneItem(e),e.sendMessage({rawtext:[{translate:"action.reach_level"},{text:` ${u+1}/50`},{translate:"action.in_armor"}]}),setScore(e,"armor",u+1),e.setProperty("hfrlc:armor_unlock",u+1),e.playSound("random.levelup")),"hfrlc:agility_token"===t.typeId&&v<50&&(takeOneItem(e),e.sendMessage({rawtext:[{translate:"action.reach_level"},{text:` ${v+1}/50`},{translate:"action.in_agility"}]}),setScore(e,"agility",v+1),e.setProperty("hfrlc:agility_unlock",v+1),e.playSound("random.levelup")),"hfrlc:mining_token"===t.typeId&&f<50&&(takeOneItem(e),e.sendMessage({rawtext:[{translate:"action.reach_level"},{text:` ${f+1}/50`},{translate:"action.in_mining"}]}),e.playSound("random.levelup"),setScore(e,"mining",f+1),e.setProperty("hfrlc:mining_unlock",f+1)),levelDetect(e),healCrystal(e)}}export function systemLevelHurt(e,t,a,l,o,n){if(t&&"minecraft:player"==t.typeId){if("projectile"==l&&t.hasTag("level_speed40")){(a=Math.floor(100*Math.random())+1)<=getScore(t,"agility")-30&&(t.hasTag("dodge")||(t.removeTag("dodge_active"),t.addTag("dodge")))}t.hasTag("level_armor40")&&(a=Math.floor(100*Math.random())+1)<20&&addEffect(t,"regeneration",10,3),t.hasTag("level_armor10")&&e&&"entityExplosion"!=l&&(t.hasTag("dragon_armor_equip")&&e.applyDamage(Math.round(o)+4),t.hasTag("dragon_armor_equip")||e.applyDamage(Math.round(o)+1))}e&&skillsDamage(e,t,a,l,o,n)}export function systemLevelReset(e){world.scoreboard.getObjective("melee").setScore(e,0),world.scoreboard.getObjective("mining").setScore(e,0),world.scoreboard.getObjective("armor").setScore(e,0),world.scoreboard.getObjective("agility").setScore(e,0),e.setProperty("hfrlc:melee_unlock",0),e.setProperty("hfrlc:mining_unlock",0),e.setProperty("hfrlc:armor_unlock",0),e.setProperty("hfrlc:agility_unlock",0)}system.runInterval(()=>{for(const e of world.getAllPlayers()){const t=calculateTotalValue(e);e.setProperty("hfrlc:power_level",t)}},12e3);