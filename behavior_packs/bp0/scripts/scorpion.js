import{GameMode}from"@minecraft/server";import{secondsToTicks}from"./libs/utils";import{bVector3}from"./libs/better_vectors";export const DATA={id:"hfrlc:scorpion",baby_id:"hfrlc:baby_scorpion",alert:{distance:12},attack_types:{none:"none",regular_attack:"regular_attack",heavy_attack:"heavy_attack",sting_attack:"sting_attack"},sting_attack:{effect:"wither",duration:secondsToTicks(3),amplifier:2}};export async function tick(t){if(!t.getProperty("hfrlc:dead"))if(t.getProperty("hfrlc:has_target"))t.getProperty("hfrlc:player_nearby")&&(t.setProperty("hfrlc:player_nearby",!1),t.triggerEvent("hfrlc:no_player_nearby"),t.triggerEvent("hfrlc:movement_on"),t.triggerEvent("hfrlc:choose_attack"),t.setProperty("hfrlc:rotation_locked",!1));else{let e,r=0,o=1/0;for(const a of t.dimension.getEntities({type:"minecraft:player",location:t.location,maxDistance:32}))if(a.getGameMode()===GameMode.survival||a.getGameMode()===GameMode.adventure){let n=bVector3.fromVector3(a.location),c=bVector3.fromVector3(t.location),i=bVector3.distance(n,c);i<=DATA.alert.distance&&(r++,i<=o&&(o=i,e=a))}if(r>0&&!t.getProperty("hfrlc:player_nearby")?(t.setProperty("hfrlc:player_nearby",!0),t.triggerEvent("hfrlc:player_nearby"),t.triggerEvent("hfrlc:movement_off")):0===r&&t.getProperty("hfrlc:player_nearby")&&(t.setProperty("hfrlc:player_nearby",!1),t.triggerEvent("hfrlc:no_player_nearby"),t.triggerEvent("hfrlc:movement_on")),e){let r=bVector3.fromVector3(e.getVelocity()),o=t.getComponent("minecraft:movement"),a=o?.currentValue||.35;r.multiply(a),r.y=0,t.applyImpulse(r);let n=bVector3.fromVector3(e.location),c=bVector3.fromVector3(t.location),i=bVector3.subtract(n,c);t.setRotation({x:0,y:i.angles().theta}),t.setProperty("hfrlc:rotation",i.angles().theta),t.setProperty("hfrlc:rotation_locked",!0)}}}export function onAttack(t){const{damagingEntity:e,hitEntity:r}=t;e.typeId===DATA.id&&e.getProperty("hfrlc:attack_type")===DATA.attack_types.sting_attack&&r&&r.isValid()&&r?.addEffect(DATA.sting_attack.effect,DATA.sting_attack.duration,{amplifier:DATA.sting_attack.amplifier,showParticles:!0})}export function onEvent(t){t.entity.typeId!==DATA.id&&t.entity.typeId!==DATA.baby_id||"hfrlc:death"===t.eventId&&t.entity&&t.entity?.isValid()&&!t.entity.getProperty("hfrlc:rotation_locked")&&(t.entity.setProperty("hfrlc:rotation",t.entity.getRotation().y),t.entity.setProperty("hfrlc:rotation_locked",!0))}