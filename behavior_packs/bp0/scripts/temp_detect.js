import{world}from"@minecraft/server";import{addScore,setScore,getScore}from"./functions.js";import{reactive_thirst}from"./thirts.js";const clamp=(e,t,r)=>Math.min(Math.max(e,t),r),updateThermometer=(e,t,r)=>{const a=world.scoreboard.getObjective("thermometer"),o=(world.scoreboard.getObjective("temperature"),getScore(e,"workstate"));if(!a)return;const s=getScore(e,"thermometer")||0,m="add"===t?s+(r+3*o+e.isJumping?2:0):s-(r+3*o+e.isJumping?2:0);setScore(e,"thermometer",clamp(m,0,12e3))};function tempTagsCondition(e,t,r){if(!e.hasTag("dead_temp")){const a=e.getGameMode();"spectator"!=a&&"creative"!=a&&(processTemperature(e,t,r),handleThermometerEvents(e,r));const o=e.hasTag("its_raining"),s=e.hasTag("near_heatsource");r>=5980&&r<=6020&&!s&&!o&&0==t&&!e.hasTag("do_tuto0")&&setScore(e,"thermometer",6e3),r<0&&setScore(e,"thermometer",0),r>12e3&&setScore(e,"thermometer",12e3)}}let adjustmentMatrix;function processTemperature(e,t,r){if(e.hasTag("desactive_temp")||e.hasTag("do_tuto0"))return;e.hasTag("its_daytime");const a=e.hasTag("its_nighttime"),o=e.hasTag("its_raining"),s=e.hasTag("near_coldsource"),m=e.hasTag("near_heatsource");if(e.isInWater&&r>6e3&&addScore(e,"thermometer",-50),adjustmentMatrix={1:{base:o?a?4:2:a?2:1,nearSource:o?a?12:10:a?10:6},2:{base:o?a?1:2:a?2:4,nearSource:o?a?6:10:a?10:12},0:{aboveNormal:{base:o?a?3:2:a?2:1,nearColdSource:o?a?7:6:a?6:5,nearHeatSource:o?a?4:6:a?3:5},belowNormal:{base:o?a?3:2:a?1:2,nearColdSource:o?a?7:6:a?6:4,nearHeatSource:o?a?5:8:a?3:6}}},1===t||2===t){const r=s||m?adjustmentMatrix[t].nearSource:adjustmentMatrix[t].base;updateThermometer(e,1===t?"remove":"add",r)}else if(0===t){const t=r>6021,n=t?adjustmentMatrix[0].aboveNormal:adjustmentMatrix[0].belowNormal,c=s?n.nearColdSource:m?n.nearHeatSource:n.base;updateThermometer(e,a&&o||s||t?m?"add":"remove":"add",c)}}export function TempScore(e){const t=getScore(e,"temperature")||0,r=getScore(e,"thermometer")||0;tempTagsCondition(e,t,r);const a=e.getGameMode();"spectator"!=a&&"creative"!=a&&(processTemperature(e,t,r),handleThermometerEvents(e,r),e.hasTag("no_survival")&&(reactive_thirst(e),e.triggerEvent("hfrlc:bodyparts_active"),e.removeTag("no_survival"))),"spectator"!=a&&"creative"!=a||e.hasTag("no_survival")||(e.onScreenDisplay.setTitle("hide_all;"),e.runCommandAsync("title @s subtitle hide;"),e.triggerEvent("hfrlc:bodyparts_desactive"),e.addTag("no_survival"))}function handleThermometerEvents(e,t){if(e.hasTag("used")||e.hasTag("desactive_temp")||e.hasTag("do_tuto0"))return;const r=[{min:9600,max:12e3,event:"hfrlc:thermometer_veryhot"},{min:7200,max:9599,event:"hfrlc:thermometer_hot"},{min:4800,max:7199,event:"hfrlc:thermometer_normal"},{min:2400,max:4799,event:"hfrlc:thermometer_cold"},{min:0,max:2399,event:"hfrlc:thermometer_verycold"}];for(const{min:a,max:o,event:s}of r)if(t>=a&&t<=o){e.triggerEvent(s);break}}