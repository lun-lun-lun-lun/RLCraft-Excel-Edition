import{system,world,EntityEquippableComponent,EquipmentSlot,ItemStack}from"@minecraft/server";import{ModalFormData,ActionFormData}from"@minecraft/server-ui";import{w}from"./functions.js";export function warpstoneNames(e){"hfrlc:warpstone"==e.typeId&&(e.nameTag="Warpstone")}export function warpstoneHitEntity(e,t){warpstoneFunc(e,t,new WaystoneUI(t))}class WaystoneUI{constructor(e){this.add_warpstone_menu=new ModalFormData,this.show_warpstone_menu=new ActionFormData,this.source=e}showAddWaystoneMenu(e){return this.add_warpstone_menu.title({rawtext:[{translate:"action.warpstone.title"}]}),this.add_warpstone_menu.textField({rawtext:[{text:"\n "},{translate:"action.warpstone.body"}]},{rawtext:[{translate:"action.warpstone.name"}]}),this.add_warpstone_menu.show(this.source).then(e)}showWaystonesMenu(e,t){return this.show_warpstone_menu.title({rawtext:[{translate:"action.warpstone.list"}]}),e.forEach(e=>this.show_warpstone_menu.button(e)),this.show_warpstone_menu.show(this.source).then(t)}}function warpstoneFunc(e,t,n){let o,a=[""],s=[""],r=["space_between_buttons","§o§0Rename§r"];if("hfrlc:warpstone"!=e.typeId||t.isSneaking||(e.hasTag("name")||e.hasTag("sub")||(e.addTag("name"),n.showAddWaystoneMenu(({formValues:n,canceled:a})=>{if(a&&e.removeTag("name"),!a){const a=t.dimension.getEntities({type:"hfrlc:warpstone",name:`${n[0]}`});0==a.length&&(o={w_name:`§l§0${n[0]}`,w_pos:`${Math.floor(e.location.x)+2} ${Math.floor(e.location.y)} ${Math.floor(e.location.z)}`,w_dim:`${e.dimension.id}`},e.addTag("sub"),e.addTag(`${t.name}`),e.nameTag=`${n[0]}`,world.scoreboard.addObjective(JSON.stringify(o))),a.length>0&&(e.removeTag("name"),t.sendMessage({translate:"action.warpstone_name"}))}})),e.hasTag("sub")&&(world.scoreboard.getObjectives().forEach(e=>{e.id.startsWith('{"w_name":')&&(r.unshift(JSON.parse(e.id).w_name),a.unshift(JSON.parse(e.id).w_pos),s.unshift(JSON.parse(e.id).w_dim))}),n.showWaystonesMenu(r,({selection:i,canceled:l})=>{i<r.length-1&&null!=world.getDimension(`${s[i]}`)&&(world.getDimension(`${s[i]}`).runCommandAsync(`tp "${t.name}" ${a[i]}`),system.runTimeout(()=>{t.hasTag("desactive_lens")||w.getEntities({type:"hfrlc:lens_sun",tags:[`${t.name}`]}).forEach(e=>{e.isValid()&&(e.remove(),t.removeTag("lens_active"))})},2)),i==r.length-1&&n.showAddWaystoneMenu(({formValues:n,canceled:a})=>{if(!a){const a=t.dimension.getEntities({type:"hfrlc:warpstone",name:`${n[0]}`});0==a.length&&(world.scoreboard.removeObjective(JSON.stringify({w_name:`§l§0${e.nameTag}`,w_pos:`${Math.floor(e.location.x)+2} ${Math.floor(e.location.y)} ${Math.floor(e.location.z)}`,w_dim:`${e.dimension.id}`})),o={w_name:`§l§0${n[0]}`,w_pos:`${Math.floor(e.location.x)+2} ${Math.floor(e.location.y)} ${Math.floor(e.location.z)}`,w_dim:`${e.dimension.id}`},world.scoreboard.addObjective(JSON.stringify(o)),e.nameTag=`${n[0]}`),a.length>0&&t.sendMessage({translate:"action.warpstone_name"})}})}))),"hfrlc:warpstone"==e.typeId&&t.isSneaking){if(e.getProperty("hfrlc:natural_warpstone"))return void t.onScreenDisplay.setActionBar({translate:"action.warpstone_break"});e.triggerEvent("hfrlc:item_drop"),o={w_name:`§l§0${e.nameTag}`,w_pos:`${Math.floor(e.location.x)+2} ${Math.floor(e.location.y)} ${Math.floor(e.location.z)}`,w_dim:`${e.dimension.id}`},world.scoreboard.removeObjective(JSON.stringify(o))}}