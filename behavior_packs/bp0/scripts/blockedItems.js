import{world,EntityEquippableComponent,EquipmentSlot,EnchantmentType,ItemStack}from"@minecraft/server";import{addEffect,getScore}from"./functions.js";const itemsLevelRequirements={"hfrlc:wooden_dagger":{melee:1,agility:1},"hfrlc:wooden_spear":{melee:2},"minecraft:wooden_sword":{melee:3},"hfrlc:dirt_sword":{melee:3},"hfrlc:golden_dagger":{melee:4,agility:2},"hfrlc:golden_spear":{melee:5},"minecraft:golden_sword":{melee:6},"hfrlc:stone_dagger":{melee:7,agility:3},"hfrlc:stone_spear":{melee:8},"minecraft:stone_sword":{melee:9},"hfrlc:spike_sword":{melee:9},"hfrlc:iron_dagger":{melee:10,agility:5},"hfrlc:weapon_9":{melee:11,agility:6},"hfrlc:weapon_2":{melee:12},"hfrlc:iron_spear":{melee:13},"minecraft:iron_sword":{melee:14},"hfrlc:darkness_sword":{melee:14},"hfrlc:jungle_sword":{melee:15},"hfrlc:weapon_1":{agility:15},"hfrlc:weapon_11":{melee:15,agility:10},"hfrlc:weapon_12":{agility:10},"hfrlc:diamond_dagger":{melee:19,agility:8},"hfrlc:diamond_spear":{melee:20},"hfrlc:dragon_bone_bow":{agility:20},"hfrlc:fire_dragon_bow":{agility:20},"hfrlc:ice_dragon_bone_bow":{agility:20},"hfrlc:weapon_4":{melee:21},"hfrlc:water_sword":{melee:22},"minecraft:diamond_sword":{melee:23},"hfrlc:light_sword":{melee:23,agility:1},"hfrlc:air_sword":{melee:23,agility:2},"hfrlc:weapon_8":{melee:23,agility:3},"hfrlc:netherite_dagger":{melee:24,agility:12},"hfrlc:netherite_spear":{melee:25,agility:5},"minecraft:netherite_sword":{melee:26},"hfrlc:weapon_3":{melee:26,agility:7},"hfrlc:fire_sword":{melee:27,agility:8},"hfrlc:ice_sword":{melee:28,agility:9},"hfrlc:ocean_sword":{melee:29,agility:10},"hfrlc:weapon_6":{melee:30,agility:11},"hfrlc:weapon_10":{melee:31,agility:12},"hfrlc:weapon_7":{melee:32,agility:13},"hfrlc:weapon_5":{melee:33,agility:14},"hfrlc:dragon_bone_dagger":{melee:34,agility:18},"hfrlc:dragon_bone_spear":{melee:35,agility:16},"hfrlc:dragon_bone_katana":{melee:36,agility:17},"hfrlc:dragon_bone_hammer":{melee:37,agility:18},"hfrlc:dragon_bone_sword":{melee:38,agility:19},"hfrlc:earth_sword":{melee:39,agility:20},"minecraft:mace":{melee:40,agility:20},"hfrlc:ice_dragon_bone_dagger":{melee:40,agility:25},"hfrlc:ice_dragon_bone_katana":{melee:41,agility:22},"hfrlc:ice_dragon_bone_spear":{melee:42,agility:23},"hfrlc:ice_dragon_bone_hammer":{melee:43,agility:24},"hfrlc:ice_dragon_bone_sword":{melee:44,agility:25},"hfrlc:fire_dragon_bone_dagger":{melee:45,agility:32},"hfrlc:fire_dragon_bone_katana":{melee:46,agility:27},"hfrlc:fire_dragon_bone_spear":{melee:47,agility:28},"hfrlc:fire_dragon_bone_hammer":{melee:48,agility:29},"hfrlc:fire_dragon_bone_sword":{melee:49,agility:30},"hfrlc:lava_sword":{melee:50,agility:31},"hfrlc:wither_sword":{melee:50,agility:32},"hfrlc:poison_sword":{melee:50,agility:33},"hfrlc:ender_sword":{melee:50,agility:34},"hfrlc:storm_sword":{melee:50,agility:35},"hfrlc:thunder_sword":{melee:50,agility:36},"hfrlc:nether_sword":{melee:50,agility:37},"hfrlc:legendary_katana":{melee:50,agility:38},"hfrlc:elemental_sword":{melee:50,agility:39},"hfrlc:weapon_13":{melee:15},"minecraft:diamond_axe":{melee:19,mining:20},"minecraft:diamond_hoe":{melee:15,mining:20},"minecraft:diamond_pickaxe":{melee:15,mining:20},"minecraft:diamond_shovel":{melee:17,mining:20},"minecraft:golden_axe":{melee:5,mining:3},"minecraft:golden_hoe":{melee:3,mining:3},"minecraft:golden_pickaxe":{melee:3,mining:3},"minecraft:golden_shovel":{melee:4,mining:3},"minecraft:iron_axe":{melee:11,mining:12},"minecraft:iron_hoe":{melee:8,mining:12},"minecraft:iron_pickaxe":{melee:8,mining:12},"minecraft:iron_shovel":{melee:9,mining:12},"minecraft:bow":{agility:6},"minecraft:crossbow":{agility:6},"minecraft:trident":{melee:13,agility:6},"minecraft:netherite_axe":{melee:22,mining:25},"minecraft:netherite_hoe":{melee:17,mining:25},"minecraft:netherite_pickaxe":{melee:17,mining:25},"minecraft:netherite_shovel":{melee:19,mining:25},"minecraft:stone_axe":{melee:7,mining:5},"minecraft:stone_hoe":{melee:5,mining:5},"minecraft:stone_pickaxe":{melee:5,mining:5},"minecraft:stone_shovel":{melee:6,mining:5},"minecraft:wooden_axe":{melee:2,mining:1},"minecraft:wooden_hoe":{melee:1,mining:1},"minecraft:wooden_pickaxe":{melee:1,mining:1},"minecraft:wooden_shovel":{melee:1,mining:1}},baseArmorTypes={"minecraft:leather_":2,"minecraft:chainmail_":5,"minecraft:golden_":6,"minecraft:iron_":8,"hfrlc:pirate_":12,"minecraft:diamond_":16,"hfrlc:samurai_":25,"hfrlc:earth_dragon_":25,"hfrlc:brown_dragon_":30,"minecraft:netherite_":35,"hfrlc:dark_dragon_":40,"hfrlc:red_dragon_":45,"hfrlc:blue_dragon_":45,"hfrlc:green_dragon_":45},fixedArmorItems={"minecraft:turtle_helmet":7,"minecraft:shield":11,"minecraft:elytra":30},armorPieces=["helmet","chestplate","leggings","boots"],armorsLevelRequirements={};for(const[e,i]of Object.entries(baseArmorTypes))for(const n of armorPieces)armorsLevelRequirements[`${e}${n}`]={armor:i};for(const[r,t]of Object.entries(fixedArmorItems))armorsLevelRequirements[r]={armor:t};const combinedLevelRequirements={...itemsLevelRequirements,...armorsLevelRequirements};function setLevelLore(e,i,n,r,t){const l=i.getLore()||[];let o=[],a=!1;o[0]="";for(let e=0;e<n.length;e++){const{score:i,level:r,category:t}=n[e],m=l[e+1]||"",c=`${i<r?"§c":"§a"} ${t} Level ${r}`;m.trim()!==c.trim()?(o[e+1]=c,a=!0):o[e+1]=m}a&&(i.setLore(o),t.setItem(r,i))}function checkBlockedItems(e,i,n,r,t,l,o){const a=(i,n,r)=>{if(n&&r<n){addEffect(e,"mining"===i?"mining_fatigue":"weakness",30,255,!1)}},m=i.getEquipment(EquipmentSlot.Mainhand);if(m){const e=itemsLevelRequirements[m.typeId];e&&(a("melee",e.melee,n),a("agility",e.agility,r),a("mining",e.mining,t))}const c=[EquipmentSlot.Head,EquipmentSlot.Chest,EquipmentSlot.Legs,EquipmentSlot.Feet,EquipmentSlot.Offhand];for(const n of c){const r=i.getEquipment(n);if(!r)continue;const t=armorsLevelRequirements[r.typeId];if(t&&t.armor&&l<t.armor){i.setEquipment(n,void 0);const t=new ItemStack(r.typeId,1),l=r.getComponent("durability")?.damage;if(void 0!==l){const e=t.getComponent("durability");e&&(e.damage=l)}const a=r.getComponent("enchantable");if(a){const e=a.getEnchantments();if(e.length>0){const i=t.getComponent("enchantable");for(const n of e)i.addEnchantment({type:new EnchantmentType(n.type.id),level:n.level})}}o.addItem(t),e.onScreenDisplay.setActionBar({translate:"blocked.armor"})}}const g={melee:n,agility:r,mining:t,armor:l},f=Object.keys(g);for(let i=0;i<o.size;i++){const n=o.getItem(i);if(!n)continue;const r=Object.keys(combinedLevelRequirements).find(e=>n.typeId===e);if(!r)continue;const t=combinedLevelRequirements[r],l=f.filter(e=>void 0!==t[e]).map(e=>({score:g[e],level:t[e],category:e.charAt(0).toUpperCase()+e.slice(1)}));setLevelLore(e,n,l,i,o)}}export function blokedItems_events(e,i){if("hfrlc:blokedItems"==i&&e.matches({excludeGameModes:["creative"]})){const i=getScore(e,"melee"),n=getScore(e,"mining"),r=getScore(e,"agility"),t=getScore(e,"armor"),l=e.getComponent("inventory").container,o=e.getComponent(EntityEquippableComponent.componentId);checkBlockedItems(e,o,i,r,n,t,l)}}