import{system,EntityDamageCause}from"@minecraft/server";import{getScore,addEffect,removeEffect,takeOneItem}from"./functions.js";export function bodypartSpawn(e){e.hasTag("dead_bodyparts")&&e.hasTag("active_bodypart")&&(e.triggerEvent("hfrlc:bodyparts_reset"),e.triggerEvent("hfrlc:desactive_arms_heal"),e.triggerEvent("hfrlc:desactive_legs_heal"),e.triggerEvent("hfrlc:desactive_head_heal"),e.triggerEvent("hfrlc:desactive_body_heal"),e.removeTag("random_body"),e.removeTag("body_broken"),e.removeTag("random_head"),e.removeTag("head_broken"),e.removeTag("larm_hurt"),e.removeTag("rarm_hurt"),e.removeTag("larm_broken"),e.removeTag("rarm_broken"),e.removeTag("lleg_hurt"),e.removeTag("rleg_hurt"),e.removeTag("lleg_broken"),e.removeTag("rleg_broken"),e.removeTag("dead_bodyparts"))}export function bodypart_events(e,r){if("minecraft:player"!=e.typeId||e.hasTag("active_bodypart"))switch(r){case"hfrlc:active_negativeEffect":system.runTimeout(()=>{negativeEffect(e)},5);break;case"hfrlc:negativeEffect":negativeEffect(e);break;case"hfrlc:dead_bodyparts":["hfrlc:bodyparts_reset","hfrlc:desactive_arms_heal","hfrlc:desactive_legs_heal","hfrlc:desactive_head_heal","hfrlc:desactive_body_heal"].forEach(r=>e.triggerEvent(r)),e.addTag("dead_bodyparts")}}export function hitStoneOrLog(e,r,a,t,l,g){if("creative"===l||e.hasTag("desactive_hitlog"))return;const n=r.hasTag("minecraft:is_pickaxe_item_destructible"),o=t?.hasTag("minecraft:is_pickaxe"),i=r.hasTag("wood"),h=t?.hasTag("minecraft:is_axe");n&&!o?(g.cancel=!0,system.run(()=>{e.addTag("view_stone"),e.applyDamage(3,{cause:EntityDamageCause.magic}),r.dimension.setBlockType(r.location,"minecraft:air")})):n&&!o||system.run(()=>{e.removeTag("view_stone")}),i&&!h?(g.cancel=!0,system.run(()=>{e.addTag("view_log"),e.applyDamage(3,{cause:EntityDamageCause.magic}),addEffect(e,"mining_fatigue",40,0,!1),r.dimension.setBlockType(r.location,"minecraft:air")})):i&&!h||system.run(()=>{e.removeTag("view_log")})}export function bodypartItemCompleteUse(e,r){if("hfrlc:bandage"===r.typeId){const r=["rleg_heal","lleg_heal","larm_heal","rarm_heal"],a=["larm_heal","rarm_heal","rleg_heal","lleg_heal"],t=Math.floor(4*Math.random()),l=Math.floor(4*Math.random());removeEffect(e,"weakness"),takeOneItem(e),addEffect(e,"regeneration",20,2,!1),e.triggerEvent(`hfrlc:${r[t]}`),e.triggerEvent(`hfrlc:${a[l]}`)}"hfrlc:heal3"===r.typeId&&addEffect(e,"instant_health",5,1,!1),"hfrlc:heal2"===r.typeId&&(addEffect(e,"regeneration",30,4,!1),e.triggerEvent("hfrlc:larm_heal"),e.triggerEvent("hfrlc:rleg_heal"),e.triggerEvent("hfrlc:rarm_heal"),e.triggerEvent("hfrlc:lleg_heal"),e.triggerEvent("hfrlc:random_legs_recover"),e.triggerEvent("hfrlc:random_arms_recover")),"hfrlc:heal1"===r.typeId&&addEffect(e,"regeneration",10,4,!1),"minecraft:golden_apple"!==r.typeId&&"minecraft:golden_carrot"!==r.typeId||(e.triggerEvent("hfrlc:larm_heal"),e.triggerEvent("hfrlc:rleg_heal"),e.triggerEvent("hfrlc:rarm_heal"),e.triggerEvent("hfrlc:lleg_heal"),e.triggerEvent("hfrlc:random_legs_recover"),e.triggerEvent("hfrlc:random_arms_recover")),"minecraft:enchanted_golden_apple"===r.typeId&&e.triggerEvent("hfrlc:bodyparts_reset")}function negativeEffect(e){const r=e.getGameMode();"spectator"!=r&&"creative"!=r&&((!e.hasTag("larm_broken")&&e.hasTag("rarm_broken")||e.hasTag("larm_broken")&&!e.hasTag("rarm_broken"))&&(addEffect(e,"weakness",80,0,!1),e.hasTag("goat_horns")||e.hasTag("dragon_slayer")||e.hasTag("great_horn")||e.hasTag("panacea")||addEffect(e,"mining_fatigue",80,0,!1)),(e.hasTag("rarm_kill")&&!e.hasTag("larm_kill")||!e.hasTag("rarm_kill")&&e.hasTag("larm_kill"))&&(addEffect(e,"weakness",80,1,!1),e.hasTag("goat_horns")||e.hasTag("dragon_slayer")||e.hasTag("great_horn")||e.hasTag("panacea")||addEffect(e,"mining_fatigue",80,2,!1)),e.hasTag("rarm_broken")&&e.hasTag("larm_broken")&&(addEffect(e,"weakness",80,1,!1),e.hasTag("goat_horns")||e.hasTag("dragon_slayer")||e.hasTag("great_horn")||e.hasTag("panacea")||addEffect(e,"mining_fatigue",80,1,!1)),e.hasTag("rarm_kill")&&e.hasTag("larm_kill")&&(addEffect(e,"weakness",80,2,!1),e.hasTag("goat_horns")||e.hasTag("dragon_slayer")||e.hasTag("great_horn")||e.hasTag("panacea")||addEffect(e,"mining_fatigue",80,3,!1)),e.hasTag("ancient")||e.hasTag("dragon_slayer")||e.hasTag("panacea")||((e.hasTag("lleg_broken")&&!e.hasTag("rleg_broken")||!e.hasTag("lleg_broken")&&e.hasTag("rleg_broken"))&&addEffect(e,"slowness",80,0,!1),(e.hasTag("lleg_kill")&&!e.hasTag("rleg_kill")||!e.hasTag("lleg_kill")&&e.hasTag("rleg_kill"))&&addEffect(e,"slowness",80,1,!1),e.hasTag("rleg_broken")&&e.hasTag("lleg_broken")&&addEffect(e,"slowness",80,1,!1),e.hasTag("rleg_kill")&&e.hasTag("lleg_kill")&&addEffect(e,"slowness",80,2,!1)))}export function bodypartEntityHurt(e,r,a,t,l,g){if("minecraft:player"!==e.typeId)return;const n=e.hasTag("level_armor30")?getScore(e,"armor"):0;if((e.hasTag("level_armor30")?getRandomInt(1,100):1)<n&&e.hasTag("active_bodypart"))l.setCurrentValue(a+Math.round(r));else{if((e.hasTag("view_stone")||e.hasTag("view_log"))&&!e.hasTag("do_tuto2")&&"magic"===t)return e.triggerEvent("hfrlc:random_arms");if(e.hasTag("active_bodypart")&&!e.hasTag("active_tuto24"))if("fall"!==t&&"stalagmite"!==t||e.hasTag("lleg_kill")||e.hasTag("rleg_kill"))if("drowning"===t){if(a<=54&&a>0){const r=getRandomInt(1,10);e.triggerEvent(r<=5?"hfrlc:random_head":"hfrlc:random_body")}}else handleOtherInjury(e,r,a);else a<60&&handleFallInjury(e,r)}}function handleFallInjury(e,r){r>=2&&r<4?e.triggerEvent("hfrlc:random_legs"):r>=4&&r<6?(runLegHurt(e),triggerMultiple(e,"hfrlc:random_legs",2)):r>=6&&r<14?(runLegBroken(e),triggerMultiple(e,"hfrlc:random_legs",2)):r>=14&&(triggerMultiple(e,"hfrlc:lleg_kill",2),triggerMultiple(e,"hfrlc:rleg_kill",2))}function handleOtherInjury(e,r,a){if(1===r&&a<=59){const r=getRandomInt(1,9);r<=2?e.triggerEvent("hfrlc:random_legs"):r<=4&&e.triggerEvent("hfrlc:random_arms"),a<=54&&triggerCombo(e,r)}if(r>=2&&r<4&&a<=59){const r=getRandomInt(1,10);r<=5?e.triggerEvent("hfrlc:random_legs"):e.triggerEvent("hfrlc:random_arms"),a<=54&&triggerCombo(e,r)}if(r>=4&&r<7&&a<=59){const r=getRandomInt(1,12);switch(!0){case r<=3:runCombo1(e);break;case r<=6:runCombo2(e);break;case r<=9:runCombo3(e);break;case r<=12:runCombo4(e)}}r>=7&&r<10&&a<=59&&runFullBreak(e),r>=10&&a<=59&&triggerDeathCombo(e)}function triggerCombo(e,r){r<=2?(triggerMultiple(e,"hfrlc:random_head",1),triggerMultiple(e,"hfrlc:random_arms",1),triggerMultiple(e,"hfrlc:random_legs",1)):r<=4&&(triggerMultiple(e,"hfrlc:random_body",1),triggerMultiple(e,"hfrlc:random_arms",1),triggerMultiple(e,"hfrlc:random_legs",1))}function runLegHurt(e){e.runCommandAsync("event entity @s[tag=!lleg_broken,tag=!lleg_kill] hfrlc:lleg_hurt"),e.runCommandAsync("event entity @s[tag=!rleg_broken,tag=!rleg_kill] hfrlc:rleg_hurt")}function runLegBroken(e){e.runCommandAsync("event entity @s[tag=!lleg_broken,tag=!lleg_kill] hfrlc:lleg_broken"),e.runCommandAsync("event entity @s[tag=!rleg_broken,tag=!rleg_kill] hfrlc:rleg_broken")}function runFullBreak(e){["rleg","lleg","larm","rarm"].forEach(r=>e.runCommandAsync(`event entity @s[tag=!${r}_broken,tag=!${r}_kill] hfrlc:${r}_broken`)),triggerMultiple(e,"hfrlc:random_head",1),triggerMultiple(e,"hfrlc:random_body",1),triggerMultiple(e,"hfrlc:random_arms",1),triggerMultiple(e,"hfrlc:random_legs",2)}function runCombo1(e){e.runCommandAsync("event entity @s[tag=!larm_broken,tag=!larm_kill] hfrlc:larm_broken"),e.runCommandAsync("event entity @s[tag=!rleg_broken,tag=!rleg_kill] hfrlc:rleg_hurt"),triggerMultiple(e,"hfrlc:random_head",1),triggerMultiple(e,"hfrlc:random_legs",1),triggerMultiple(e,"hfrlc:random_arms",1)}function runCombo2(e){e.runCommandAsync("event entity @s[tag=!rarm_broken,tag=!rarm_kill] hfrlc:rarm_hurt"),e.runCommandAsync("event entity @s[tag=!lleg_broken,tag=!lleg_kill] hfrlc:lleg_broken"),triggerMultiple(e,"hfrlc:random_body",1),triggerMultiple(e,"hfrlc:random_arms",1),triggerMultiple(e,"hfrlc:random_legs",1)}function runCombo3(e){e.runCommandAsync("event entity @s[tag=!rarm_broken,tag=!rarm_kill] hfrlc:rarm_broken"),e.runCommandAsync("event entity @s[tag=!lleg_broken,tag=!lleg_kill] hfrlc:lleg_hurt"),triggerMultiple(e,"hfrlc:random_body",1),triggerMultiple(e,"hfrlc:random_arms",1),triggerMultiple(e,"hfrlc:random_legs",1)}function runCombo4(e){e.runCommandAsync("event entity @s[tag=!rleg_broken,tag=!rleg_kill] hfrlc:rleg_broken"),e.runCommandAsync("event entity @s[tag=!larm_broken,tag=!larm_kill] hfrlc:larm_hurt"),triggerMultiple(e,"hfrlc:random_head",1),triggerMultiple(e,"hfrlc:random_arms",1),triggerMultiple(e,"hfrlc:random_legs",1)}function triggerDeathCombo(e){triggerMultiple(e,"hfrlc:random_head",1),triggerMultiple(e,"hfrlc:random_body",1);["rleg","rarm","larm","lleg"].forEach(r=>e.runCommandAsync(`event entity @s[tag=!${r}_broken,tag=!${r}_kill] hfrlc:${r}_kill`)),triggerMultiple(e,"hfrlc:random_legs",2),triggerMultiple(e,"hfrlc:random_arms",2),triggerMultiple(e,"hfrlc:random_head",1),triggerMultiple(e,"hfrlc:random_body",1)}function triggerMultiple(e,r,a=1){for(let t=0;t<a;t++)e.triggerEvent(r)}function getRandomInt(e,r){return Math.floor(Math.random()*(r-e+1))+e}