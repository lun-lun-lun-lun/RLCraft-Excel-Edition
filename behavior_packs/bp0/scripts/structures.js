import{system,world,StructureAnimationMode}from"@minecraft/server";import{addScore,setScore,getScore}from"./functions.js";export function structure_events(o,t){"hfrlc:boss_tower"===t&&world.getPlayers().some(o=>o.hasTag("start_game"))&&(cleanItemsAndFallingBlocks(o),bossTower(o)),"hfrlc:dungeon"===t&&world.getPlayers().some(o=>o.hasTag("start_game"))&&(cleanItemsAndFallingBlocks(o),dungeon(o))}function cleanItemsAndFallingBlocks(o){const t=o.location;o.runCommandAsync(`kill @e[type=falling_block,x=${t.x},z=${t.z},y=${t.y},r=200]`),o.runCommandAsync(`execute as @e[type=item,x=${t.x},z=${t.z},y=${t.y},r=200] at @s unless entity @e[type=player,r=8] run kill @s`)}function structureManager(o,t,e,r,n,s){const a=getScore("structure_speed","settings"),c=32/Math.pow(2,a-1);world.structureManager.place(`mystructure:${o}`,t,{x:e,y:r,z:n},{animationMode:StructureAnimationMode.Layers,animationSeconds:c,rotation:s})}function structureManagerBoss(o,t,e,r,n,s){const a=getScore("structure_speed","settings"),c=56/Math.pow(2,a-1);world.structureManager.place(`mystructure:${o}`,t,{x:e,y:r,z:n},{animationMode:StructureAnimationMode.Layers,animationSeconds:c,rotation:s})}function placeRandomBossStructure(o,t,e,r="None"){structureManagerBoss(`${o}${Math.floor(3*Math.random())+1}_bossTower`,t.dimension,t.location.x+13,t.location.y+e,t.location.z+10,r)}function bossTower(o){if(o.runCommandAsync("execute as @s unless block ~~-1~ air unless block ~~~ water run tag @s add generate"),!o.hasTag("tower")&&o.hasTag("generate")&&(setScore(o,"boss_tower",0),o.runCommandAsync(`tellraw @p {"rawtext": [{"translate":"generate.boss_tower"},{"text":" §bx: §6${Math.floor(o.location.x)} §by: §6${Math.floor(o.location.y)} §bz: §6${Math.floor(o.location.z)}"},{"translate":"generate.boss"}]}`),o.addTag("tower")),o.hasTag("tower")&&o.hasTag("generate")){addScore(o,"boss_tower",5);const t=getScore(o,"boss_tower");20===t?structureManagerBoss("boss_tower1_1",o.dimension,o.location.x,o.location.y-2,o.location.z,"None"):70===t?placeRandomBossStructure("wood",o,2,"Rotate180"):90===t?(structureManagerBoss("boss_tower1_2",o.dimension,o.location.x+5,o.location.y+55,o.location.z+2,"None"),placeRandomBossStructure("stone",o,19,"Rotate180")):110===t?placeRandomBossStructure("cobble",o,36):130===t?placeRandomBossStructure("ande",o,53):150===t?placeRandomBossStructure("nether",o,70):t>160&&o.remove()}}function dungeon(o){const t="dung",e="dungeon",{x:r,y:n,z:s}=o.location,a=o.dimension,c=Math.floor,u=(o.hasTag(t)||(setScore(o,e,0),o.addTag(t)),addScore(o,e,5),getScore(o,e)),i=(o,t)=>`hf/dungeon/${o}/${t}`,l=(o,t,e,c,u)=>structureManager(o,a,r+t,n+e,s+c,u);5===u&&(o.runCommandAsync(`tellraw @p {"rawtext":[{"translate":"generate.dungeon"},{"text":" §bx: §6${c(r)} §by: §6${c(n)} §bz: §6${c(s)}"},{"translate":"generate.boss"}]}`),["stairs","stairs"].forEach((o,t)=>l(i("",o),4,-3-7*t,4,"None")));for(const{score:o,structure:t,x:e,y:r,z:n,rotation:s}of Object.values(dungeonGeneration).flat())u===o&&l(i("pre",t),e,r,n,s),u>170&&u-170===o&&l(i("post",t),e,r,n,s);u>=340&&o.remove()}const dungeonGeneration={0:[{score:10,structure:"C3",x:-26,y:-107,z:-26,rotation:"None"}],1:[{score:20,structure:"B3",x:38,y:-107,z:-26,rotation:"None"},{score:25,structure:"C2",x:-26,y:-107,z:38,rotation:"None"},{score:30,structure:"C4",x:-26,y:-107,z:-90,rotation:"None"},{score:35,structure:"D3",x:-90,y:-107,z:-26,rotation:"None"}],2:[{score:45,structure:"B2",x:38,y:-107,z:38,rotation:"None"},{score:50,structure:"B4",x:38,y:-107,z:-90,rotation:"None"},{score:55,structure:"D2",x:-90,y:-107,z:38,rotation:"None"},{score:60,structure:"D4",x:-90,y:-107,z:-90,rotation:"None"}],3:[{score:70,structure:"C5",x:-26,y:-107,z:-121,rotation:"None"}],4:[{score:80,structure:"E3",x:-122,y:-107,z:-26,rotation:"None"}],5:[{score:90,structure:"B5",x:38,y:-107,z:-121,rotation:"None"},{score:95,structure:"D5",x:-90,y:-107,z:-121,rotation:"None"}],6:[{score:105,structure:"E2",x:-122,y:-107,z:38,rotation:"None"},{score:110,structure:"E4",x:-122,y:-107,z:-90,rotation:"None"}],7:[{score:120,structure:"A3",x:102,y:-107,z:-26,rotation:"None"},{score:125,structure:"C1",x:-26,y:-107,z:102,rotation:"None"}],8:[{score:135,structure:"E5",x:-122,y:-107,z:-121,rotation:"None"}],9:[{score:145,structure:"A2",x:102,y:-107,z:38,rotation:"None"},{score:150,structure:"A4",x:102,y:-107,z:-90,rotation:"None"},{score:155,structure:"B1",x:38,y:-107,z:102,rotation:"None"},{score:160,structure:"D1",x:-90,y:-107,z:102,rotation:"None"}],10:[{score:170,structure:"E1",x:-122,y:-107,z:102,rotation:"None"}]};