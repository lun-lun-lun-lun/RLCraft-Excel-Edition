import{system,world}from"@minecraft/server";import{fix_trinket}from"./trinket.js";import{ModalFormData,ActionFormData}from"@minecraft/server-ui";import{reactive_thirst}from"./thirts.js";import{reactive_temp}from"./temp_sphere.js";import{saveInventory}from"./itemsDamage.js";import{w}from"./functions.js";export function guideBook(t,e){if("hfrlc:info_book"!==e.typeId)return;(new ActionFormData).title({translate:"action.guidebook.title"}).button({translate:"action.guidebook.how_to_play"},"textures/ui/ServerUIcons/question.png").button({translate:"action.guidebook.adding_packs_title"},"textures/ui/ServerUIcons/adding_packs.png").button({translate:"action.guidebook.gameplay_settings_title"},"textures/ui/ServerUIcons/gameplay_settings.png").button({translate:"action.guidebook.visual_settings_title"},"textures/ui/ServerUIcons/visual_settings.png").button({translate:"action.guidebook.social_title"},"textures/ui/ServerUIcons/discord.png").button({translate:"action.guidebook.creditsandlicenses_title"},"textures/ui/ServerUIcons/credits.png").show(t).then(o=>{switch(o.selection){case 0:showTutorialForm(t,e);break;case 1:showAddingPacksForm(t,e);break;case 2:system.runTimeout(()=>{gameplaySettingsMenu(t)},5);break;case 3:system.runTimeout(()=>{visualSettingsMenu(t)},5);break;case 4:(new ActionFormData).title({rawtext:[{translate:"action.guidebook.social_title"},{text:"§q§r"}]}).body({translate:"action.guidebook.social_body"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)guideBook(t,e)});break;case 5:showCreditsAndLicenses(t,e)}})}function showTutorialForm(t,e){(new ActionFormData).title({translate:"action.guidebook.how_to_play"}).button({translate:"action.guidebook.how_to_start"},"textures/ui/ServerUIcons/how_to_start.png").button({translate:"action.guidebook.retry_tutorial"},"textures/ui/ServerUIcons/tutorial.png").button({translate:"action.guidebook.thirst_title"},"textures/ui/ServerUIcons/thirst.png").button({translate:"action.guidebook.grave_title"},"textures/ui/ServerUIcons/graves.png").button({translate:"action.guidebook.level_title"},"textures/ui/ServerUIcons/levelup.png").button({translate:"action.guidebook.temp_title"},"textures/ui/ServerUIcons/temperature.png").button({translate:"action.guidebook.trinket_title"},"textures/ui/ServerUIcons/trinket.png").button({translate:"action.guidebook.way_title"},"textures/ui/ServerUIcons/waystones.png").button({translate:"action.guidebook.taming_title"},"textures/ui/ServerUIcons/taming.png").button({translate:"action.guidebook.dungeons_title"},"textures/ui/ServerUIcons/dungeons.png").button({translate:"action.guidebook.back"}).show(t).then(o=>{switch(o.selection){case 0:(new ActionFormData).title({translate:"action.guidebook.how_to_start"}).body({translate:"action.guidebook.how_start_text"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)showTutorialForm(t,e)});break;case 1:{const o=t.getComponent("health"),a=t.getVelocity(),n=Math.hypot(a.x,a.y,a.z),i=t.dimension.getEntities({type:"minecraft:player",tags:["do_tuto0"],location:t.location,maxDistance:320}),s=()=>t.dimension.playSound("note.banjo",t.location,{pitch:.5});if(t.hasTag("do_tuto0"))return t.sendMessage({translate:"action.guidebook.already_doing_tutorial"}),void s();if(i.length>0||"minecraft:overworld"!==t.dimension.id)return t.sendMessage({translate:"action.guidebook.tuto_nearby"}),void s();if(o.currentValue<o.effectiveMax)return t.sendMessage({translate:"action.guidebook.be_full_health_first"}),void s();if(0!==n)return t.onScreenDisplay.setActionBar({translate:"action.stop_move"}),void s();(new ActionFormData).title({translate:"action.guidebook.retry_tutorial"}).body({translate:"action.guidebook.tutorial_body"}).button({translate:"action.guidebook.yes"}).button({translate:"action.guidebook.no"}).show(t).then(o=>{switch(o.selection){case 0:saveInventory(t);const o=t.location,a=world.structureManager.get("mystructure:wood_only");world.structureManager.place(a,t.dimension,{x:o.x-6,y:-62,z:o.z-2}),t.removeTag("system_level_item"),t.removeTag("active_bodypart"),t.removeTag("skip_tuto"),t.triggerEvent("hfrlc:black_room"),system.runTimeout(()=>{t?.isValid()&&(t.teleport({x:o.x,y:-60,z:o.z}),t.triggerEvent("hfrlc:do_tuto"),t.addTag("do_tuto0"),t.addTag("desactive_lens"),t.addTag("lens_active"),t.removeTag("start_game"),t.runCommandAsync("function hide_ui"),t.onScreenDisplay.setTitle("hide;"))},20);break;case 1:showTutorialForm(t,e)}});break}case 2:(new ActionFormData).title({translate:"action.guidebook.thirst_title"}).body({translate:"action.guidebook.thirst_body"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)showTutorialForm(t,e)});break;case 3:(new ActionFormData).title({translate:"action.guidebook.grave_title"}).body({translate:"action.guidebook.grave_body"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)showTutorialForm(t,e)});break;case 4:(new ActionFormData).title({translate:"action.guidebook.level_title"}).body({translate:"action.guidebook.level_body"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)showTutorialForm(t,e)});break;case 5:(new ActionFormData).title({translate:"action.guidebook.temp_title"}).body({translate:"action.guidebook.temp_body"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)showTutorialForm(t,e)});break;case 6:(new ActionFormData).title({translate:"action.guidebook.trinket_title"}).body({translate:"action.guidebook.trinket_body"}).button({translate:"action.guidebook.trinket_fix"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{switch(o.selection){case 0:const o=t.getTags(),a=t.getViewDirection(),n=t.location;fix_trinket(t,o,a,n);break;case 1:showTutorialForm(t,e)}});break;case 7:(new ActionFormData).title({translate:"action.guidebook.way_title"}).body({translate:"action.guidebook.way_body"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)showTutorialForm(t,e)});break;case 8:(new ActionFormData).title({translate:"action.guidebook.taming_title"}).body({translate:"action.guidebook.taming_body"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)showTutorialForm(t,e)});break;case 9:(new ActionFormData).title({translate:"action.guidebook.dungeons_title"}).body({translate:"action.guidebook.dungeons_body"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)showTutorialForm(t,e)});break;case 10:guideBook(t,e)}})}function showAddingPacksForm(t,e){(new ActionFormData).title({rawtext:[{translate:"action.guidebook.adding_packs2_title"},{text:"§q§f§f§r"}]}).button({translate:"action.guidebook.video_explaination_title"},"textures/ui/ServerUIcons/youtube.png").button({translate:"action.guidebook.add_aands_title"},"textures/ui/ServerUIcons/aands.png").button({translate:"action.guidebook.add_more_packs_title"},"textures/ui/ServerUIcons/adding_packs.png").button({translate:"action.guidebook.realms_disclaimer_title"},"textures/ui/ServerUIcons/realms.png").button({translate:"action.guidebook.back"}).show(t).then(o=>{switch(o.selection){case 0:(new ActionFormData).title({rawtext:[{translate:"action.guidebook.video_explaination_title"},{text:"§q§s"}]}).body({translate:"action.guidebook.video_explaination_body"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)showAddingPacksForm(t,e)});break;case 1:(new ActionFormData).title({translate:"action.guidebook.add_aands_title"}).body({translate:"action.guidebook.add_aands_body"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)showAddingPacksForm(t,e)});break;case 2:(new ActionFormData).title({translate:"action.guidebook.add_more_packs_title"}).body({translate:"action.guidebook.add_more_packs_body"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)showAddingPacksForm(t,e)});break;case 3:(new ActionFormData).title({translate:"action.guidebook.realms_disclaimer_title"}).body({translate:"action.guidebook.realms_disclaimer_body"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)showAddingPacksForm(t,e)});break;case 4:guideBook(t,e)}})}function showCreditsAndLicenses(t,e){(new ActionFormData).title({translate:"action.guidebook.creditsandlicenses_title"}).button({translate:"action.guidebook.credits_title"},"textures/ui/ServerUIcons/credits.png").button({translate:"action.guidebook.licenses_title"},"textures/ui/ServerUIcons/licenses.png").button({translate:"action.guidebook.back"}).show(t).then(o=>{switch(o.selection){case 0:(new ActionFormData).title({translate:"action.guidebook.credits_title"}).body({translate:"action.guidebook.credits_body"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)showCreditsAndLicenses(t,e)});break;case 1:showLicensesForm(t,e);break;case 2:guideBook(t,e)}})}function showLicensesForm(t,e){(new ActionFormData).title({translate:"action.guidebook.licenses_title"}).button({translate:"action.guidebook.rlcraft_title"},"textures/ui/ServerUIcons/rlcraft.png").button({translate:"action.guidebook.notreepunching_title"},"textures/ui/ServerUIcons/no_tree_punching.png").button({translate:"action.guidebook.weapons_title"},"textures/ui/ServerUIcons/weapons.png").button({translate:"action.guidebook.skybox_title"},"textures/ui/ServerUIcons/skybox.png").button({translate:"action.guidebook.back"}).show(t).then(o=>{switch(o.selection){case 0:(new ActionFormData).title({translate:"action.guidebook.rlcraft_title"}).body({translate:"action.guidebook.rlcraft_body"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)showLicensesForm(t,e)});break;case 1:(new ActionFormData).title({translate:"action.guidebook.notreepunching_title"}).body({translate:"action.guidebook.notreepunching_body"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)showLicensesForm(t,e)});break;case 2:(new ActionFormData).title({translate:"action.guidebook.weapons_title"}).body({translate:"action.guidebook.weapons_body"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)showLicensesForm(t,e)});break;case 3:(new ActionFormData).title({translate:"action.guidebook.skybox_title"}).body({translate:"action.guidebook.skybox_body"}).button({translate:"action.guidebook.back"}).show(t).then(o=>{if(0===o.selection)showLicensesForm(t,e)});break;case 4:showCreditsAndLicenses(t,e)}})}const settingsScoreboard=world.scoreboard.getObjective("settings"),settings={skyspires:{},dungeons:{},structure_speed:{}};for(let t in settings)if(!settingsScoreboard.hasParticipant(t)){let e=1;"structure_speed"===t&&(e=3),settingsScoreboard.setScore(t,e)}function gameplaySettingsMenu(t){const e={thirst:!t.hasTag("desactive_thirst"),temp:!t.hasTag("desactive_temp"),wood:!t.hasTag("desactive_hitlog")},o=!1!==world.gameRules.naturalRegeneration,a=settingsScoreboard.getScore("skyspires"),n=settingsScoreboard.getScore("dungeons"),i=settingsScoreboard.getScore("structure_speed");(new ModalFormData).title({translate:"action.guidebook.gameplay_settings_title"}).toggle({translate:"action.guidebook.thirst_disable"},e.thirst).toggle({translate:"action.guidebook.temp_disable"},e.temp).toggle({translate:"action.guidebook.wood_punching"},e.wood).toggle({translate:"action.guidebook.natural_regen"},o).toggle({translate:"action.guidebook.skyspires"},0!==a).toggle({translate:"action.guidebook.dungeons"},0!==n).slider({translate:"action.guidebook.structure_speed"},1,5,1,i).show(t).then(e=>{if(e.canceled||!e.formValues)return;const[s,r,c,l,d,u,g]=e.formValues;[["desactive_thirst",s,reactive_thirst],["desactive_temp",r,()=>reactive_temp(t)],["desactive_hitlog",c]].forEach(([e,o,a])=>{const n=t.hasTag(e),i=()=>{o&&n?(t.removeTag(e),a&&a(t)):o||n||(t.addTag(e),"desactive_temp"===e&&(t.runCommandAsync("title @s subtitle hide;"),t.onScreenDisplay.setTitle("hide_sphere;"),t.triggerEvent("remove_cold_shaking")))};"desactive_thirst"===e?system.runTimeout(()=>{i(),o||n||t.onScreenDisplay.setTitle("hide;")},5):i()}),l!==o&&(world.gameRules.naturalRegeneration=l);const b=d?1:0,k=u?1:0;b!==a&&settingsScoreboard.setScore("skyspires",b),k!==n&&settingsScoreboard.setScore("dungeons",k),i!==g&&(settingsScoreboard.setScore("structure_speed",g),t.runCommandAsync("event entity @e[family=structure] minecraft:entity_spawned"))})}function visualSettingsMenu(t){const e=e=>t.hasTag(e),o={lens:!e("desactive_lens"),lagwarn:!e("desactive_lagwarn"),damage_indicator:!e("desactive_damage_indicator"),vv_optimization:!!t.getProperty("hfrlc:vv_optimization")},a=t.getProperty("hfrlc:bodyparts_posx"),n=t.getProperty("hfrlc:bodyparts_posy");(new ModalFormData).title({translate:"action.guidebook.visual_settings_title"}).toggle({translate:"action.guidebook.lens_disable"},o.lens).toggle({translate:"action.guidebook.lagwarn"},o.lagwarn).toggle({translate:"action.guidebook.damage_indicator"},o.damage_indicator).toggle({translate:"action.guidebook.vv_optimization"},o.vv_optimization).slider({translate:"action.guidebook.bodyparts_posx"},0,90,1,a).slider({translate:"action.guidebook.bodyparts_posy"},0,45,1,n).show(t).then(o=>{if(o.canceled||!o.formValues)return;const[i,s,r,c,l,d]=o.formValues,u=(o,a,n=null)=>{const i=e(o);a&&i?(t.removeTag(o),n?.()):a||i||t.addTag(o)},g=()=>{t.removeTag("lens_active"),w.getEntities({type:"hfrlc:lens_sun"}).forEach(e=>{e.isValid()&&e.getTags().some(e=>e.includes(t.name))&&e.remove()})};u("desactive_lens",i,g),u("desactive_lagwarn",s),u("desactive_damage_indicator",r);c!==!!t.getProperty("hfrlc:vv_optimization")&&(t.setProperty("hfrlc:vv_optimization",c),c?(e("desactive_lens")||(t.addTag("desactive_lens"),g()),t.setProperty("hfrlc:custom_fog","none"),t.runCommandAsync("fog @s remove custom_fog")):e("desactive_lens")&&t.removeTag("desactive_lens")),a!==l&&t.setProperty("hfrlc:bodyparts_posx",l),n!==d&&t.setProperty("hfrlc:bodyparts_posy",d)})}