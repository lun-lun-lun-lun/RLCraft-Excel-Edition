import{system,world}from"@minecraft/server";function generateSandwormID(){const t="abcdefghijklmnopqrstuvwxyz",n="0123456789",e=t+n,a=t=>{const n=Math.floor(Math.random()*t.length);return t.charAt(n)};let r=[a(t),a(n)];for(let t=0;t<6;t++)r.push(a(e));for(let t=r.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[r[t],r[n]]=[r[n],r[t]]}return"sandworm_id-"+r.join("")}function getRelativeCoords(t,n,e,a,r){const o=a*(Math.PI/180);return{x:t+-Math.sin(o)*r,y:n,z:e+Math.cos(o)*r}}export function handleEntitySpawn(t){if("hfrlc:sandworm_head"!==t.entity.typeId)return;const n=t.entity,e=generateSandwormID();n.addTag(e)}export function handleDataDrivenTrigger(t){if("hfrlc:sandworm_head"!==t.entity.typeId)return;const n=t.entity,e=n.getTags().find(t=>t.includes("sandworm_id-"));if(!e)return;const a=n.dimension,r=n.location,o=n.getRotation();switch(t.eventId){case"hidden_to_ground":const t=a.getEntities({type:"hfrlc:sandworm_wheel",location:r,maxDistance:64,closest:1,tags:[e]}).length>0,i=a.getEntities({type:"hfrlc:sandworm_tail",location:r,maxDistance:64,closest:1,tags:[e]}).length>0;if(t||i)return;n.runCommand(`event entity @e[family=sandworm_bodypart, tag=${e}] death`);const d=getRelativeCoords(r.x,r.y,r.z,o.y,-13),s=getRelativeCoords(r.x,r.y,r.z,o.y,-26),c=a.spawnEntity("hfrlc:sandworm_wheel",{x:d.x,y:d.y+1,z:d.z});c.setRotation(o),c.addTag(e);const l=a.spawnEntity("hfrlc:sandworm_tail",{x:s.x,y:s.y+1,z:s.z});l.setRotation(o),l.addTag(e);break;case"ground_to_hidden":case"death":n.runCommand(`event entity @e[family=sandworm_bodypart, tag=${e}] death`);break;case"despawn_from_distance":n.runCommand(`event entity @e[family=sandworm_bodypart, tag=${e}] despawn`)}}export function handleEntityDie(t){if(t.deadEntity.typeId.includes("hfrlc:sandworm")){const n=t.deadEntity,e=n.getTags().find(t=>t.includes("sandworm_id-"));if(!e)return;n.runCommand(`event entity @e[family=sandworm, tag=${e}] despawn`)}}export function handleEntityHurt(t){const{hurtEntity:n,damage:e,damageSource:a}=t;if(!["hfrlc:sandworm_wheel","hfrlc:sandworm_tail"].includes(n.typeId))return;const r=n,o=r.getTags().find(t=>t.startsWith("sandworm_id-"));if(!o)return;const[i]=r.dimension.getEntities({type:"hfrlc:sandworm_head",tags:[o]});if(!i)return;const d=e*({"hfrlc:sandworm_wheel":.5,"hfrlc:sandworm_tail":.25}[r.typeId]||1);i.applyDamage(d,{cause:a.cause,damagingEntity:a.damagingEntity,damagingProjectile:a.damagingProjectile})}